# Аргументы командной строки Picodata
Picodata является консольным приложением, которое поддерживает различные параметры запуска в виде аргументов командной строки. 

Полный список аргументов доступен с помощью команды `picodata help`:

```console
USAGE:
    picodata <SUBCOMMAND>

OPTIONS:
    -h, --help       Print help information
    -V, --version    Print version information

SUBCOMMANDS:
    connect      Сonnect a Picodata instance and start interactive Lua console
    expel        Expel node from cluster
    help         Print this message or the help of the given subcommand(s)
    run          Run the picodata instance
    tarantool    Run tarantool
    test         Run picodata integration tests
```

В общем случае после `picodata` следует указать название команды и затем, опционально, параметры:

```console
picodata <command> [<params>]
```

## Команда `run` [](){:name='run'}
Запускает инстанс (экземпляр) Picodata.

### Использование
```
picodata run [Параметры]
```

### Параметры

#### advertise [](){:name='advertise'}
`--advertise <[host][:port]>`<br>
Адрес, по которому другие инстансы смогут подключиться к данному инстансу. По умолчанию используется значение из аргумента `--listen`.
Аналогичная переменная окружения: `PICODATA_ADVERTISE`.

#### cluster-id [](){:name='cluster-id'}
`--cluster-id <name>`<br>
Имя кластера. Инстанс не сможет стать частью кластера, если у него указано другое имя.
Аналогичная переменная окружения: `PICODATA_CLUSTER_ID`.

#### data-dir [](){:name='data-dir'}
`--data-dir <path>`<br>
Директория, в которой инстанс будет сохранять свои данные для постоянного хранения.
Аналогичная переменная окружения: `PICODATA_DATA_DIR`.

#### failure-domain [](){:name='failure-domain'}
`--failure-domain <key=value>`<br>
Список параметров географического расположения сервера (через запятую). Также этот аргумент называется _зоной доступности_.
Каждый параметр должен быть в формате КЛЮЧ=ЗНАЧЕНИЕ. Также, следует помнить о том, что добавляемый инстанс должен обладать 
тем же набором доменов (т.е. ключей данного аргумента), которые уже есть в кластере.
Picodata будет избегать помещения двух инстансов в один репликасет, если хотя бы один параметр зоны доступности у них совпадает.
Соответственно, инстансы будут формировать новые репликасеты.
Аналогичная переменная окружения: `PICODATA_FAILURE_DOMAIN`.
<!-- Picodata следит за тем, чтобы репликасеты наполнялись
инстансами с разными зонами доступности до тех пор пока не достигнут заданный фактор репликации. -->

#### help [](){:name='help'}
`-h, --help`[](){:name='help'}<br>
Вывод справочной информации.

#### http-listen [](){:name='http-listen'}
`--http-listen <[host][:port]>` <br>
Адрес, на котором будет доступен запущенный
[HTTP-сервер](https://github.com/tarantool/http){:target="_blank"}. Для
работы с API маршрутизации в Lua следует использовать переменную
`_G.pico.httpd`. Сервер будет запущен только при явном указании
`--http-listen` с корректным адресом.<br> Аналогичная переменная
окружения: `PICODATA_HTTP_LISTEN`.

#### init-replication-factor [](){:name='init-replication-factor'}
`--init-replication-factor <INIT_REPLICATION_FACTOR>`<br>
Число реплик (инстансов с одинаковым набором хранимых данных) для каждого репликасета.
Аргумент используется только при начальном создании кластера и в дальнейшем игнорируется. 
Аналогичная переменная окружения: `PICODATA_INIT_REPLICATION_FACTOR`.

#### instance-id [](){:name='instance-id'}
`--instance-id <name>`<br>
Название инстанса. Если этот аргумент не указать, то название будет сгенерировано автоматически.
Данный аргумент удобно использовать для явного указания инстанса при его перезапуске
(например, в случае его недоступности или при переносе в другую сеть).
Аналогичная переменная окружения: `PICODATA_INSTANCE_ID`.

#### listen [](){:name='listen'}
`-l, --listen <[host][:port]>`<br>
Адрес и порт привязки инстанса. По умолчанию используется localhost:3301
Аналогичная переменная окружения: `PICODATA_LISTEN`.

#### log-level [](){:name='log-level'}
`--log-level <LOG_LEVEL>`<br>
Уровень регистрации событий. Возможные значения:  fatal, system, error, crit, warn, info, verbose, debug.
По умолчанию используется уровень info.
Аналогичная переменная окружения: `PICODATA_LOG_LEVEL`.

#### peer [](){:name='peer'}
`--peer <[host][:port]>`<br>
Адрес другого инстанса. В данном аргументе можно передавать несколько значений через запятую.
По умолчанию используется значение localhost:3301, т.е. без связывания с каким-либо другим инстансом.
Указание порта опционально. Аналогичная переменная окружения: `PICODATA_PEER`.

#### replicaset-id [](){:name='replicaset-id'}
`--replicaset-id <name>`<br>
Название целевого репликасета. Аналогичная переменная окружения: `PICODATA_REPLICASET_ID`

#### script [](){:name='script'}
`--script <path>`<br>
Путь к файлу Lua-скрипта, который будет выполнен после присоединения инстанса к кластеру. 
Аналогичная переменная окружения: `PICODATA_SCRIPT`.

## Команда `connect`[](){:name='connect'}
Подключается к указанному инстансу и открывает интерактивную Lua-консоль

### Использование
```
picodata connect [Параметры] <Аргументы>
```

### Аргументы
`ADDRESS`: Адрес инстанса Picodata в формате `[user@][host][:port]`.
<!-- При указании неполного адреса,
недостающая часть будет взята из значений по умолчанию (текущий хост,
порт 3301). По умолчанию подключение производится под пользователем
`guest` и пустым паролем.-->

### Параметры
- `-a, --auth_type <METHOD>`, тип аутентификации. По умолчанию
  используется `chap-sha1`, также доступны `md5` и `ldap`.
- `-h, --help`, вывод справки о команде `connect`.
- `-u, --user <USER>`, пользователь, под которым будет инициировано
  подключение. Если пользователь указан в рамках `<ADDRESS>`, то параметр
  `--user` игнорируется.

### Пример

```console
picodata connect localhost:3301
```
### Подключение под определенным пользователем

```console
picodata connect --user user_name localhost:3301
```

## Команда `tarantool` [](){:name='tarantool'}
Запускает Tarantool и открывает его Lua-консоль.

<!-- Открывает консоль c Lua-интерпретатором, в котором можно
взаимодействовать с СУБД аналогично тому, как это происходит в обычной
консоли Tarantool. Никакая логика Picodata поверх Tarantool не
выполняется, соответственно, кластер не инициализируется и подключение к
кластеру не производится. Запускается консоль экземпляра Tarantool,
встроенного в Picodata (но не установленного обычного Tarantool, если
такой есть в системе).-->

### Использование
```
picodata tarantool [Параметры]
```
### Параметры

- `-h, --help`, вывод справки о команде `tarantool`.

## Команда `expel` [](){:name='expel'}
Исключает инстанс Picodata из состава кластера.

### Использование
```
picodata expel [Параметры]
```
### Параметры

- `--cluster-id <name>`, имя кластера, из которого должен быть исключен инстанс (по умолчанию это `demo`).
- `-h, --help`, вывод справки о команде `expel`.
- `--instance-id <name>`, имя инстанса, который следует исключить (без указания имени `expel` не имеет силы).
- `--peer <[host][:port]>`, адрес любого инстанса из состава кластера (по умолчанию это `localhost:3301`).

## Сценарии применения команд [](){:name='cases'}

Ниже приведены типовые ситуации и подходящие для этого команды.

1. На хосте с инстансом `i4` вышел из строя жесткий диск, данные
   инстанса утрачены, сам инстанс неработоспособен. Какой-то из
   оставшихся инстансов доступен по адресу `192.168.104.55:3301`.

    ```
    picodata expel --instance-id i4 --peer 192.168.104.9:3301
    ```

2. В кластере `mycluster` из 3-х инстансов, где каждый работает на своем
   физическом сервере, происходит замена одного сервера. Выключать
   инстанс нельзя, так как оставшиеся 2 узла кластера не смогут создать
   стабильный кворум. Поэтому сначала в сеть добавляется дополнительный сервер:

    ```
    picodata run --instance-id i4 --peer 192.168.104.1 --cluster-id mycluster
    ```

    Далее, если на сервере с инстансом i3 настроен автоматический
    перезапуск Picodata в Systemd или как-либо иначе, то его нужно
    предварительно отключить. После этого c любого из уже работающих
    серверов кластера исключается инстанс i3:

    ```
    picodata expel --instance-id i3 --cluster-id mycluster
    ```

    Указанная команда подключится к `127.0.0.1:3301`, который
    самостоятельно найдет лидера кластера и отправит ему команду на
    исключение инстанса `i3`. Когда процесс `picodata` на i3 завершится
    — сервер можно выключать.


Подробнее об устройстве кластера и репликасетов Picodata см. разделе [Развертывание кластера](../deploy).

---
[Исходный код страницы](https://git.picodata.io/picodata/picodata/docs/-/blob/main/docs/cli.md)
