# Пользователи, привилегии и роли
В данном разделе описаны [SQL-команды](../references/queries.md) для управления
доступом с помощью ролевой модели в Picodata.

## Ролевая модель {: #role-model }
Ролевая модель Picodata позволяет гибко разграничивать возможности
пользователей распределенной системы. Разграничение строится на базе
трех основных понятий: [пользователей](../general/glossary.md#user),
[привилегий](../general/glossary.md#privilege) и [ролей](../general/glossary.md#role).
Привилегии можно назначать напрямую пользователям:

![Users and privileges](../images/user_priv.svg)

Также, привилегии могут быть назначены роли, которая, в свою очередь,
может быть присвоена пользователю:

![Users and roles](../images/user_roles.svg)

У каждого пользователя может быть одна или несколько ролей. Каждому
пользователю или роли может быть назначена одна или несколько
привилегий. Список объектов, которым могут быть назначены привелении, [приведен ниже](#objects).

## Начало работы {: #getting-started }
Для начала работы с пользователями, привилегиями и ролями иследует
[подключиться](tutorial_first_steps.md#accessing-console) к
интерактивной консоли инстанса Picodata. Для ввода команд можно
использовать как формат Lua, так и язык SQL напрямую, в зависимости от
[выбранного](../references/queries.md#available_langs) языка консоли. В примерах
ниже использован язык SQL.

## Создание пользователя {: #creating-user }
Создание нового пользователя происходит с помощью SQL-команды `create
user`, функциональность которой аналогична Lua-функции
[`pico.create_user()`](../references/api.md#picocreate_user).

Приведем пример создания нового пользователя:

```sql
pico.sql([[
	create user peppa
    with password 'P@ssw0rd'
    using md5
	option (timeout = 3.0)
]])
```

Команда состоит из следующих элементов:

- обязательные `имя пользователя` и `пароль` (без экранирования символов, в одинарных кавычках);
- обязательный метод аутентификации (`'chap-sha1'` | `'md5'` | `'ldap'`);
- опциональный таймаут перед возвращением управления пользователю.

При использовании методов аутентификации `chap-sha1` и `md5` требуется использовать пароль не короче 8
символов, для метода `ldap` длина пароля не проверяется.

## Удаление пользователя {: #dropping-user }
Удаление пользователя с известным именем:

```sql
pico.sql([[
	drop user peppa
]])
```

## Создание роли {: #creating-role }

Создание новой роли происходит с помощью SQL-команды `create
role`, функциональность которой аналогична Lua-функции
[`pico.create_role()`](../references/api.md#picocreate_role).

Приведем пример создания новой роли:

```sql
pico.sql([[
	create role reader
	option (timeout = 3.0)
]])
```

## Удаление роли {: #dropping-role }

Удаление роли с известным именем:

```sql
pico.sql([[
	drop role reader
]])
```
## Управление привилегиями {: #managing-privileges }
### Назначение и снятие привилегий {: #grant-and-revoke }
В Picodata предусмотрены две SQL-команды для управления привилегиями:

- `GRANT` для назначения привилегии пользователю или роли
- `REVOKE` для изъятия привилегии у пользователя или роли

### Доступные привилегии {: #available-privileges }
Доступные привилегии можно условно разделить на три группы:

Работа с пользователями:

- `CREATE` — создание пользователя
- `ALTER` — изменение пользователя
- `DROP` — удаление пользователя
- `SESSION` — подключение к Picodata по сети

Работа с ролями:

- `CREATE` — создание роли
- `DROP` — удаление роли

Работа с таблицами:

- `CREATE` — создание таблицы
- `ALTER` — изменение таблицы
- `DROP` — удаление таблицы
- `READ` — чтение данных из таблицы
- `WRITE` — запись данных в таблицу

### Объекты привилегий {: #target-objects }
Привилегии иогут быть применены к следующим целевым сущностям: <a
name="objects"></a>

- `TABLE` — таблица
- `ROLE` — роль
- `USER` — пользователь

<!--
### Примеры команд {: #cli-examples }
Наделение пользователя правом записи в таблицу:
```sql
pico.sql([[
	grant write on "friends_of_peppa" to "peppa"
	]])
```

Создание роли, наделение её правом записи в таблицу, присваивание роли пользователю:
```sql
pico.sql([[
	create role "swine_admin"
	grant write on "friends_of_peppa" to "swine_admin"
	grant "swine_admin" to "peppa"
	]])
```

Изъятие привилегии у роли:
```sql
pico.sql([[
	revoke write on "friends_of_peppa" from "swine_admin"
	]])
``` -->


См. также [`pico.grant_privilege`](../references/api.md#picogrant_privilege) и [`pico.revoke_privilege`](../references/api.md#picorevoke_privilege)

---
[Исходный код страницы](https://git.picodata.io/picodata/picodata/docs/-/blob/main/docs/tutorials/tutorial_users.md)
