# Использование журнала аудита

## Общие сведения  {: #overview }

На каждом инстансе Picodata можно включить регистрацию событий и
запись соответствующей информации в журнал аудита.

Журнал аудита позволяет администратору отслеживать все важные события,
которые влияют на безопасность кластера Picodata, включая, например,
создание новых учетных записей, изменение их паролей и привилегий, и
т.д.

Журнал представляет собой массив строк с разметкой `json`, где каждой
строке соответствует одно событие. Пример журнала:

```
{"time": "2023-11-21T16:25:13.857+0300", "level": "WARN", "auth_type":"md5","message":"created user `PEPPA`","title":"create_user", "pid": 187632 , "cord_name": "main", "fiber_id": 111, "fiber_name": "raft_main_loop", "file": "src\/storage.rs", "line": 2633}
{"time": "2023-11-21T16:29:33.252+0300", "level": "WARN", "message":"created table `friends_of_peppa`","title":"create_table", "pid": 187632 , "cord_name": "main", "fiber_id": 111, "fiber_name": "raft_main_loop", "file": "src\/traft\/node.rs", "line": 758}
{"time": "2023-11-21T16:30:47.928+0300", "level": "WARN", "message":"created role `READER`","title":"create_role", "pid": 187632 , "cord_name": "main", "fiber_id": 111, "fiber_name": "raft_main_loop", "file": "src\/storage.rs", "line": 2685}
```

Полный список возможных событий, которые регистрируются в журнал
инстанса Picodata, указан в справочнике [Регистрируемые события
безопасности](../reference/audit_events.md)

## Способы ведения журнала

Каждый узел кластера ведет свой собственный журнал, но настройка
параметров журнала производится централизованно. В зависимости от
настройки, журнал может вестись следующими способами:

- в виде текстового файла, по строчке на событие. В таком случае смотреть его можно
средствами защищенной ОС, а также при помощи API, предоставляемых самой
СУБД.
- с использованием внешнего процесса-коллектора, который СУБД должна
будет запустить при старте узла. В этом случае журнал будет поступать в
текстовом виде на вход процессу-коллектору (через stdin). Вся дальнейшая
логика работы целиком зависит от запущенного процесса; например, он
может отправлять журнал в централизованное внешнее хранилище.
- с использованием syslog (является средством защищенной ОС). Подобная схема
решает вопросы архивации, ротации и оповещения администратора.
В качестве реализации syslog на современных дистрибутивах Linux часто
используется journald (компонент системного менеджера systemd), который
имеет множество настроек и даже позволяет отправлять журналы на внешние
хосты.

## Включение журнала {: #enable-audit-log }

По умолчанию, запись событий не ведется. Включить журнал можно при
[запуске инстанса в интерактивном режиме](../reference/cli.md#audit)
<!-- - с помощью API-функции [pico.audit()](../reference/api.md#picoaudit) -->

Для примера, задействуем файл журнала при запуске инстанса с интерактивной консолью

Вывод журнала в текстовый файл:

```bash
picodata run -i --audit=/tmp/audit.log
```

Вывод журнала в syslog:

```bash
picodata run -i --audit=syslog:
```

## Получение доступа к журналу {: #access-audit-log }

Если журнал выводится в отдельный текстовый файл, то отслеживать
изменения в нем можно следующей командой:

```bash
tail -f /tmp/audit.log
```

Вывод журнала в syslog в современных дистрибутивах Linux предполагает доступ к данным с помощью `journalctl` (компонента Systemd).
Для изоляции событий, относящихся только к инстансу Picodata, используем такую команду:

```bash
journalctl -f _COMM=picodata
```
