# Установка Picodata
Данный раздел содержит сведения об установке Picodata на локальный
компьютер.

## Установка готовых пакетов {: #available-packages }
Picodata поставляется для поддерживаемых операционных систем и
предназначена для архитектуры x86_64. Мы поддерживаем собственные
репозитории с готовыми пакетами для RHEL/CentOS 7-8, РЕД ОС 7.3 "Муром",
Astra Linux 1.7 SE, Debian 11, Ubuntu 20.04, 22.04 и Alt Linux p10.
Внутри пакетов находится статически слинкованная версия исполняемого
файла `picodata`. Более подробная информация об установке приведена на
сайте
[https://picodata.io/download](https://picodata.io/download/){:target="_blank"}.

## Установка из исходного кода {: #installing-from-sources }
### Необходимые инструменты для сборки {: #prerequisites }
- Rust и Cargo 1.71 или новее
- Cmake 3.16 или новее
- gcc, g++
- libstc++-static

### Предварительные действия для CentOS 8 {: #centos-8 }
Используйте следующие команды для установки необходимых зависимостей для
сборки Picodata из исходного кода. Обратите внимание, что потребуется
установить актуальные версии Rust и Cargo, используя официальные
инструкции с сайта [rustup.rs](http://www.rustup.rs):
```bash
sudo dnf config-manager --set-enabled powertools
sudo dnf in -y gcc gcc-c++ make cmake git patch libstdc++-static
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source "$HOME/.cargo/env"
```
### Предварительные действия для Ubuntu 22.04 {: #ubuntu-22.04 }
Используйте следующие команды для установки необходимых зависимостей для
сборки Picodata из исходного кода. Обратите внимание, что Ubuntu 22.04
предоставляет актуальные версии Rust и Cargo в стандартном репозитории,
поэтому для их установки следует использовать `apt-get`:
```bash
sudo apt-get install build-essential cargo git cmake -y
```

### Предварительные действия для Alt Server p10 {: #alt-server-p10}
Используйте следующие команды для установки необходимых зависимостей для
сборки Picodata из исходного кода. Обратите внимание, что потребуется
установить актуальные версии Rust и Cargo, используя официальные
инструкции с сайта [rustup.rs](http://www.rustup.rs):
```bash
su -
apt-get install gcc gcc-c++ cmake git patch libstdc++10-devel-static libgomp10-devel-static -y && exit
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source "$HOME/.cargo/env"
```

### Получение исходного когда и сборка {: #building-from-sources }
```bash
git clone https://git.picodata.io/picodata/picodata/picodata.git
cd picodata
git submodule update --init --recursive
```
Сборка проекта:
```bash
cargo build
```

Таким образом будет собрана debug-версия. Если вам нужна релизная
версия, используйте следующую команду при сборке:

```bash
cargo build --release
```
Бинарные файлы приложения Picodata появятся в директории `target/debug`
или `target/release`.

### Проверка установки {: #post-install-check }
Когда программное обеспечение Picodata установлено, то можно проверить
наличие в системе основного исполняемого файла `picodata`, используя
следующую команду:
```bash
which picodata
```
Ответом на неё должно быть значение `/usr/bin/picodata`, либо — если вы
устанавливали ПО вручную с другим префиксом — иное расположение,
включенное в `$PATH`. Чтобы убедиться в работоспособности ПО, а также
посмотреть его версию, используйте следующую команду:
```bash
picodata --help
```

В состав ПО также включены юнит-тесты, позволяющие проверить
работоспособность основных функций. Юнит-тесты можно запустить следующей
командой:
```bash
picodata test
```
Пример вывода команды:
```bash
running 6 tests
test test_traft_pool ... ok
test test_storage_peers ... ok
test test_storage_state ... ok
test test_storage_log ... ok
test test_mailbox ... ok
test test_version ... ok

test result: ok. 6 passed; 0 failed; finished in 0.88s
```

<!--
## Создание приложения
Для создания приложения нужно сначала придумать его имя. Например, пусть это будет `myapp`.

Запустим команду:
`picodata create-app --name myapp`

Будет соданая новая директория `myapp` с hello-world-приложением, тестами, и инструкцией по сборке и запуску в readme. Приложение — это динамическая библиотека, собранная из исходного кода на Rust.
Сборка выполняется через `cargo build`.
При запуске `cargo test`запускаются тесты.

Теперь можно менять код, собирать и тестировать.

## Структура приложения
По структуре директорий приложение похоже на типичный проект на Rust. Код находится в ./src/. Из этого кода при запуске `cargo build` собирается приложение.
В приложении обязательно должна быть специальным образом объявлена `main`-функция Picodata. Эта функция будет выполняться при запуске. Внутри этой функции при необходимости объявляются RPC handlers. В этой же функции обычно запускаются потоки (fibers) для фоновых задач.

## Развертывание и запуск приложения
Разместить приложение, динамическую библиотеку, собранную через `cargo build`, в папке на сервере, где вам удобнее, например, в `/usr/local/lib/picodata/myapp/`.

Запустить один инстанс приложения:
```
picodata run
 --app-path /usr/local/lib/picodata/myapp/
 --app myapp
 --data-dir /var/lib/picodata/myapp
 --cluster-id myapp
 --instance-id myapp1
```
Запустить остальные инстансы аналогичным образом, передавая каждому инстансу уникальные идентификаторы (`instance-id`). У несколько инстансов на одном хосте должны быть уникальные параметры `data-dir` и `listen`.
После запуска Picodata поднимет и настроит инстанс кластера, создаст на каждом инстансе глобальную Lua-таблицу `myapp`. В ней будут функции, которые можно вызывать по протоколу Tarantool, например, через `net.box call('myapp.hello_world’, {42})`.
Клиенты могут подключаться к любому инстансу и вызывать методы приложения через вызов CALL по протоколу Tarantool. Подробнее об интеграции клиентских приложений с Tarantool см. в описании [Tarantool Rust SDK](https://git.picodata.io/picodata/picodata/tarantool-module){:target="_blank"}.


## Минимальный вариант кластера

Picodata может создать кластер, состоящий всего из одного экземпляра/инстанса. Обязательных параметров у него нет, что позволяет свести запуск к выполнению всего одной простой команды:

```
picodata run
```

Можно добавлять сколько угодно последующих инcтансов — все они будут подключаться к этому кластеру. Каждому инстансу следует задать отдельную рабочую директорию (параметр `--data-dir`), а также указать адрес и порт для приема соединений (параметр `--listen`) в формате `<HOST>:<PORT>`. Фактор репликации по умолчанию равен 1 — каждый инстанс образует отдельный репликасет. Если для `--listen` указать только порт, то будет использован IP-адрес по умолчанию (127.0.0.1):

```
picodata run --data-dir i1 --listen :3301
picodata run --data-dir i2 --listen :3302
picodata run --data-dir i3 --listen :3303
```

## Кластер на нескольких серверах

Выше был показан запуск Picodata на одном сервере, что удобно для тестирования и отладки, но не отражает сценариев полноценного использования кластера. Поэтому пора запустить Picodata на нескольких серверах. Предположим, что их два: `192.168.0.1` и `192.168.0.2`. Порядок запуска будет следующим:

На `192.168.0.1`:
```shell
picodata run --listen 192.168.0.1:3301
```

На `192.168.0.2`:
```shell
picodata run --listen 192.168.0.2:3301 --peer 192.168.0.1:3301
```

На что нужно обратить внимание:

Во-первых, для параметра `--listen` вместо стандартного значения `127.0.0.1` надо указать конкретный адрес. Формат адреса допускает упрощения — можно указать только хост `192.168.0.1` (порт по умолчанию `:3301`), или только порт, но для наглядности лучше использовать полный формат `<HOST>:<PORT>`.

Значение параметра `--listen` не хранится в кластерной конфигурации и может меняться при перезапуске инстанса.

Во-вторых, надо дать инстансам возможность обнаружить друг друга для того чтобы механизм [discovery](discovery.md) правильно собрал все найденные экземпляры Picodata в один кластер. Для этого в параметре `--peer` нужно указать адрес какого-либо соседнего инстанса. По умолчанию значение параметра `--peer` установлено в `127.0.0.1:3301`. Параметр `--peer` не влияет больше ни на что, кроме механизма обнаружения других инстансов.

Параметр `--advertise` используется для установки публичного IP-адреса и порта инстанса. Параметр сообщает, по какому адресу остальные инстансы должны обращаться к текущему. По умолчанию он равен `--listen`, поэтому в примере выше не упоминается. Но, например, в случае `--listen 0.0.0.0` его придется указать явно:

```shell
picodata run --listen 0.0.0.0:3301 --advertise 192.168.0.1:3301
```

Значение параметра `--advertise` анонсируется кластеру при запуске инстанса. Его можно поменять при перезапуске инстанса или в процессе его работы командой `picodata set-advertise`.
-->
Подробнее о запуске Picodata и работе с кластером см. в разделе
[Развертывание кластера](../deploy). Параметры запуска из командной
строки описаны в разделе [Аргументы командной строки Picodata](../cli).

---
[Исходный код страницы](https://git.picodata.io/picodata/picodata/docs/-/blob/main/docs/install.md)

