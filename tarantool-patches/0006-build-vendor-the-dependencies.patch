From 84880b8be478c7abed462559e9e10b8779086a3f Mon Sep 17 00:00:00 2001
From: Georgy Moshkin <gmoshkin@picodata.io>
Date: Thu, 10 Mar 2022 17:33:56 +0300
Subject: [PATCH] build: vendor the dependencies

---
 static-build/CMakeLists.txt | 29 +++++++----------------------
 1 file changed, 7 insertions(+), 22 deletions(-)

diff --git a/static-build/CMakeLists.txt b/static-build/CMakeLists.txt
index 598c42bbc..df83e14cc 100644
--- a/static-build/CMakeLists.txt
+++ b/static-build/CMakeLists.txt
@@ -8,16 +8,6 @@ cmake_minimum_required(VERSION 2.8)
 project(tarantool-static C CXX)
 
 include(ExternalProject)
-set(OPENSSL_VERSION 1.1.1m)
-set(OPENSSL_HASH 8ec70f665c145c3103f6e330f538a9db)
-set(ZLIB_VERSION 1.2.11)
-set(ZLIB_HASH 1c9f62f0778697a09d36121ead88e08e)
-set(NCURSES_VERSION 6.2)
-set(NCURSES_HASH e812da327b1c2214ac1aed440ea3ae8d)
-set(READLINE_VERSION 8.0)
-set(READLINE_HASH 7e6c1f16aee3244a69aba6e438295ca3)
-set(UNWIND_VERSION 1.6.2)
-set(UNWIND_HASH f625b6a98ac1976116c71708a73dc44a)
 
 # Pass -isysroot=<SDK_PATH> option on Mac OS to a preprocessor and a C
 # compiler to find header files installed with an SDK.
@@ -44,8 +34,7 @@ endif()
 # OpenSSL
 #
 ExternalProject_Add(openssl
-    URL https://www.openssl.org/source/openssl-${OPENSSL_VERSION}.tar.gz
-    URL_MD5 ${OPENSSL_HASH}
+    SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../../vendor/openssl-1.1.1m
     CONFIGURE_COMMAND <SOURCE_DIR>/config
         CC=${CMAKE_C_COMPILER}
         CXX=${CMAKE_CXX_COMPILER}
@@ -63,7 +52,7 @@ ExternalProject_Add(openssl
 # ICU
 #
 ExternalProject_Add(icu
-    URL https://github.com/unicode-org/icu/releases/download/release-62-1/icu4c-62_1-src.tgz
+    SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../../vendor/icu4c-62_1
     # By default libicu is built by using clang/clang++ compiler (if it
     # exists). Here is a link for detecting compilers at libicu configure
     # script: https://github.com/unicode-org/icu/blob/7c7b8bd5702310b972f888299169bc3cc88bf0a6/icu4c/source/configure.ac#L135
@@ -89,8 +78,7 @@ ExternalProject_Add(icu
 # ZLIB
 #
 ExternalProject_Add(zlib
-    URL https://zlib.net/zlib-${ZLIB_VERSION}.tar.gz
-    URL_MD5 ${ZLIB_HASH}
+    SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../../vendor/zlib-1.2.11
     CONFIGURE_COMMAND env
         CC=${CMAKE_C_COMPILER}
         CFLAGS=${DEPENDENCY_CFLAGS}
@@ -105,8 +93,7 @@ ExternalProject_Add(zlib
 # Ncurses
 #
 ExternalProject_Add(ncurses
-    URL https://ftp.gnu.org/gnu/ncurses/ncurses-${NCURSES_VERSION}.tar.gz
-    URL_MD5 ${NCURSES_HASH}
+    SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../../vendor/ncurses-6.2
     CONFIGURE_COMMAND <SOURCE_DIR>/configure
         CC=${CMAKE_C_COMPILER}
         CXX=${CMAKE_CXX_COMPILER}
@@ -139,8 +126,7 @@ ExternalProject_Add(ncurses
 # ReadLine
 #
 ExternalProject_Add(readline
-    URL https://ftp.gnu.org/gnu/readline/readline-${READLINE_VERSION}.tar.gz
-    URL_MD5 ${READLINE_HASH}
+    SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../../vendor/readline-8.0
     CONFIGURE_COMMAND <SOURCE_DIR>/configure
         CC=${CMAKE_C_COMPILER}
         CFLAGS=${DEPENDENCY_CFLAGS}
@@ -156,7 +142,7 @@ ExternalProject_Add(readline
 #
 if (APPLE)
     ExternalProject_Add(iconv
-        URL https://ftp.gnu.org/pub/gnu/libiconv/libiconv-1.16.tar.gz
+        SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../../vendor/libiconv-1.16
         CONFIGURE_COMMAND <SOURCE_DIR>/configure
             CC=${CMAKE_C_COMPILER}
             CFLAGS=${DEPENDENCY_CFLAGS}
@@ -249,8 +235,7 @@ if (APPLE)
     )
 else()
     ExternalProject_Add(unwind
-        URL https://download.savannah.nongnu.org/releases/libunwind/libunwind-${UNWIND_VERSION}.tar.gz
-        URL_MD5 ${UNWIND_HASH}
+        SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../../vendor/libunwind-1.6.2
         CONFIGURE_COMMAND <SOURCE_DIR>/configure
             CC=${CMAKE_C_COMPILER}
             CXX=${CMAKE_CXX_COMPILER}
-- 
2.25.1

